inherit.aes = FALSE,
mapping = ggplot2::aes(x = X,
y = Y))
orig_dat %>%
ggplot2::ggplot(ggplot2::aes(x = longitude,
y = latitude,
color = bt_temp)) +
ggplot2::geom_point() +
ggplot2::theme_bw() +
ggplot2::facet_wrap(~paste(month, year, sep = "-")) +
viridis::scale_color_viridis() +
ggplot2::geom_point(data = sf::st_coordinates(shape_bsb %>%
dplyr::filter(Region == "North")) %>%
as.data.frame(),
inherit.aes = FALSE,
mapping = ggplot2::aes(x = X,
y = Y))
orig_dat %>%
ggplot2::ggplot(ggplot2::aes(x = longitude,
y = latitude,
color = bt_temp)) +
ggplot2::geom_point() +
ggplot2::theme_bw() +
ggplot2::facet_wrap(~paste(month, year, sep = "-")) +
viridis::scale_color_viridis() +
ggplot2::geom_path(data = sf::st_coordinates(shape_bsb %>%
dplyr::filter(Region == "North")) %>%
as.data.frame(),
inherit.aes = FALSE,
mapping = ggplot2::aes(x = X,
y = Y))
orig_dat %>%
ggplot2::ggplot(ggplot2::aes(x = longitude,
y = latitude,
color = bt_temp)) +
ggplot2::geom_point() +
ggplot2::theme_bw() +
ggplot2::facet_wrap(~paste(month, year, sep = "-")) +
viridis::scale_color_viridis() +
ggplot2::geom_path(data = sf::st_coordinates(shape_bsb %>%
dplyr::filter(Region == "North")) %>%
as.data.frame(),
inherit.aes = FALSE,
mapping = ggplot2::aes(x = X,
y = Y)) +
ggplot2::geom_path(data = sf::st_coordinates(shape_bsb %>%
dplyr::filter(Region == "South")) %>%
as.data.frame(),
inherit.aes = FALSE,
mapping = ggplot2::aes(x = X,
y = Y))
str(data_bt2)
str(orig_data)
str(orig_dat)
dplyr::anti_join(data_bt2 %>% dplyr::select(longitude, latitude), orig_dat %>% dplyr::select(longitude, latitude))
dplyr::inner_join(data_bt2 %>% dplyr::select(longitude, latitude), orig_dat %>% dplyr::select(longitude, latitude))
data_bt2 %>% dplyr::select(longitude, latitude) %>% dplyr::distinct()
orig_dat %>%
dplyr::select(longitude, latitude) %>%
dplyr::distinct()
data_bt2[1,1]
View(data_bt2
)
data_bt2 %>%
dplyr::select(longitude, latitude) %>%
dplyr::distinct()
orig_dat %>%
dplyr::select(longitude, latitude) %>%
dplyr::distinct()
data_bt2 %>%
dplyr::select(longitude, latitude) %>%
dplyr::distinct() %>%
str()
orig_dat %>%
dplyr::select(longitude, latitude) %>%
dplyr::distinct() %>%
str()
coord <- data_bt2 %>%
dplyr::select(longitude, latitude) %>%
dplyr::distinct()
orig_coord <- orig_dat %>%
dplyr::select(longitude, latitude) %>%
dplyr::distinct()
head(coord)
head(orig_coord)
coord
View(coord)
View(orig_coord)
coord %>% dplyr::filter(longitude < 66 & longitude > 65)
coord %>% dplyr::filter(longitude > -66 & longitude < -65)
orig_coord %>% dplyr::filter(longitude > -66 & longitude < -65)
coord %>% dplyr::filter(longitude > -66 & longitude < -65 & latitude > 41)
coord %>% dplyr::filter(longitude > -65.7 & longitude < -65 & latitude > 41)
coord %>% dplyr::filter(longitude > -65.7 & longitude < -65 & latitude > 41.5)
max(data_bt2$bottomT)
min(data_bt2$bottomT)
?viridis::scale_color_viridis()
knitr::opts_chunk$set(echo = TRUE,
warning = FALSE,
message = FALSE)
`%>%` <- magrittr::`%>%`
library(tidyverse)
library(tidync)
library(sf)
files <- list.files(path = here::here("data-raw/2024_update"),
pattern = "^glo",
full.names = TRUE)
for(i in files){
this_dat <- tidync(i) %>%
hyper_tibble(force = TRUE)
### get time info and add to tibble ----
tunit <- ncmeta::nc_atts(i, "time") %>%
dplyr::filter(name == "units") %>%
tidyr::unnest(cols = c(value))
this_dat2 <- this_dat %>%
dplyr::mutate(month = RNetCDF::utcal.nc(tunit$value, .data$time)[,"month"],
year = RNetCDF::utcal.nc(tunit$value, .data$time)[,"year"]) %>%
# filter to feb and march
dplyr::filter(month %in% 2:3) %>%
dplyr::rename(value = bottomT)
data2 <- rbind(data2, this_dat2)
# time col gets weird in join depending on if the files were formatted the same
# but month and year cols are fine
}
# url <- "http://nefsctest.nmfs.local:8080/erddap/griddap/duPontavice_bottom_temp_local.csv?sea_water_temperature_at_sea_floor%5B(1989-01-01T00:00:00Z):1:(2019-04-01T00:00:00Z)%5D%5B(35.9166666666667):1:(44.4166666666667)%5D%5B(-75.9166666666667):1:(-65.75)%5D"
# data <- read.csv(url) # this should work but seems like NEFSC is choking the download
data <- read.csv(here::here("data-raw/duPontavice_bottom_temp_local_4d04_943c_b2ef.csv"))
# data2 <- data[[2]][-1,] %>%
data2 <- data[-1,] %>%
tidyr::drop_na() %>%
dplyr::mutate(dplyr::across(2:4, as.numeric),
dplyr::across(1, lubridate::as_date),
year = lubridate::year(time),
month = lubridate::month(time)) %>%
dplyr::filter(month %in% 2:3) %>%
dplyr::rename(value = sea_water_temperature_at_sea_floor)
files <- list.files(path = here::here("data-raw/2024_update"),
pattern = "^glo",
full.names = TRUE)
for(i in files){
this_dat <- tidync(i) %>%
hyper_tibble(force = TRUE)
### get time info and add to tibble ----
tunit <- ncmeta::nc_atts(i, "time") %>%
dplyr::filter(name == "units") %>%
tidyr::unnest(cols = c(value))
this_dat2 <- this_dat %>%
dplyr::mutate(month = RNetCDF::utcal.nc(tunit$value, .data$time)[,"month"],
year = RNetCDF::utcal.nc(tunit$value, .data$time)[,"year"]) %>%
# filter to feb and march
dplyr::filter(month %in% 2:3) %>%
dplyr::rename(value = bottomT)
data2 <- rbind(data2, this_dat2)
# time col gets weird in join depending on if the files were formatted the same
# but month and year cols are fine
}
R.Version()
tunit
head(this_dat)
ncmeta::nc_atts(this_dat, "time") %>%
dplyr::filter(name == "units") %>%
tidyr::unnest(cols = c(value))
lubridate::month("2024-01-01")
head(data)
tail(data)
tail(data)
targets::tar_visnetwork()
install.packages(c("targets", "tarchetypes"))
targets::tar_visnetwork()
targets::tar_visnetwork()
targets::tar_visnetwork()
targets::tar_make()
pak::pak("kshotwell/AKesp")
targets::tar_make()
pak::pak("NEFSC/READ-EDAB-NEesp2")
targets::tar_make()
targets::tar_make()
channel <- dbutils::connect_to_database("NEFSC_USERS","atyrell")
pak::pak(remotes::install_github("NOAA-EDAB/survdat")
)0
targets::tar_visnetwork()
targets::tar_make()
targets::tar_make()
targets::tar_make()
install.packages("magick")
targets::tar_visnetwork()
install.packages("tarchetypes", dependencies = TRUE)
targets::tar_visnetwork()
install.packages("targets", dependencies = TRUE)
targets::tar_visnetwork()
devtools::load_all("../READ-EDAB-NEesp2")
?plot_risk
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
risk_fig
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5.3,
height = 4,
dpi = 300)
renv::restore()
install.packages("flextbale")
install.packages("flextable")
`r knitr::knit_exit()`
data <- params$tbl_file |>
janitor::clean_names() |>
dplyr::mutate(figure =  paste0(params$img_dir, "/", time_series)) |>
dplyr::select(-time_series)
tbl_file <- here::here("docs/bsb_indicator_table.csv") |> read.csv()
install.packages("here")
tbl_file <- here::here("docs/bsb_indicator_table.csv") |> read.csv()
data <- tbl_file |>
janitor::clean_names() |>
dplyr::mutate(figure =  paste0(params$img_dir, "/", time_series)) |>
dplyr::select(-time_series)
data <- tbl_file |>
janitor::clean_names() |>
dplyr::mutate(figure =  paste0("images", "/", time_series)) |>
dplyr::select(-time_series)
data
small_dat <- data |>
dplyr::mutate(figure = NA) |>
dplyr::select(-c(w, h)) |>
dplyr::rename(`time_series*` = figure)
colnames(small_dat) <- colnames(small_dat) |>
stringr::str_replace_all("_", " ") |>
stringr::str_to_title()
small_dat
flextable::set_flextable_defaults(font.size = 10,
padding.top = 6,
padding.bottom = 6)
tbl <- flextable::flextable(small_dat)
tbl <- flextable::width(tbl, j = 1:4,
width = params$widths,
unit = "in")
flextable::set_flextable_defaults(font.size = 10,
padding.top = 6,
padding.bottom = 6)
tbl <- flextable::flextable(small_dat)
tbl <- flextable::width(tbl, j = 1:4,
unit = "in")
flextable::set_flextable_defaults(font.size = 10,
padding.top = 6,
padding.bottom = 6)
tbl <- flextable::flextable(small_dat)
tbl <- flextable::width(tbl, j = 1:4,
width = 3,
unit = "in")
tbl <- flextable::theme_box(tbl)
for(i in 1:nrow(small_dat)){
tbl <- flextable::compose(tbl,
i = i,
j = 4,
value = flextable::as_paragraph(
flextable::as_image(src = data$figure[i],
width = data$w[i],
height = data$h[i],
unit = "in",
guess_size = FALSE)))
}
tbl <- flextable::align(tbl, i = 1, j = 1:4, align = "center", part = "header")
tbl <- flextable::align(tbl, i = 1:nrow(small_dat), j = 4, align = "center")
tbl <- flextable::bg(tbl, i = 1:nrow(small_dat), j = 1:4, bg = "white")
# TODO: this height adjustment isn't working
tbl <- flextable::height_all(tbl, part = "body", height = 2)
tbl <- flextable::hrule(tbl, i = 1:nrow(small_dat), rule = "atleast", part = "body")
tbl <- flextable::font(tbl, fontname = "Times New Roman", part = "body")
tbl <- flextable::font(tbl, fontname = "Times New Roman", part = "header")
tbl
tbl_file
tbl_file |> View()
?read.csv
here::here("docs/bsb_indicator_table.csv") |> read.csv(encoding = "UTF-8")
head(tbl_file)
tbl_file |> tibble::as_tibble()
devtools::load_all("../READ-EDAB-NEesp2")
install.packages("devtools")
devtools::load_all("../READ-EDAB-NEesp2")
NEesp2::format_tbl_data(file = tbl_file,
term_year = 2024,
dir = "images")
tbl_file <- here::here("docs/bsb_indicator_table.csv")
devtools::load_all("../READ-EDAB-NEesp2")
NEesp2::format_tbl_data(file = tbl_file,
term_year = 2024,
dir = "images")
tbl_file <- here::here("docs/bsb_indicator_table.csv")
NEesp2::format_tbl_data(file = tbl_file,
term_year = 2024,
dir = "images")
NEesp2::format_tbl_data(file = tbl_file,
term_year = 2024,
dir = "images") -> data
NEesp2::rpt_card_table(data,
widths = 3)
NEesp2::format_tbl_data(file = tbl_file,
term_year = 2024,
dir = "images") -> data
tbl_file <- here::here("docs/bsb_indicator_table.csv")
NEesp2::format_tbl_data(file = tbl_file,
term_year = 2024,
dir = "images") -> data
tbl_file <- here::here("docs/bsb_indicator_table.csv")
NEesp2::format_tbl_data(file = tbl_file,
term_year = 2024,
dir = "images") -> data
data
NEesp2::rpt_card_table(data,
widths = 3)
NEesp2::rpt_card_table(data,
widths = c(0.9, 0.75, 3, 3))
devtools::load_all("../READ-EDAB-NEesp2")
NEesp2::rpt_card_table(data,
widths = c(0.9, 0.75, 3, 3))
colnames(data)
"status_in_2024" %in% "status.+"
"status_in_2024" %in% "status(.+)"
devtools::load_all("../READ-EDAB-NEesp2")
NEesp2::rpt_card_table(data,
widths = c(0.9, 0.75, 3, 3))
NEesp2::rpt_card_table(tibble::as_tibble(data),
widths = c(0.9, 0.75, 3, 3))
flextable::flextable(data)
NEesp2::format_tbl_data(file = tbl_file,
term_year = 2024,
dir = "images") -> data
flextable::flextable(data)
NEesp2::rpt_card_table(data,
widths = c(0.9, 0.75, 3, 3))
stringr::str_detect(tbl_file, "csv$")
?set_header_labels
?flextable::set_header_labels
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
install.packages("ggplot2")
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 3,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 3.25,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 3.5,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
devtools::load_all("../READ-EDAB-NEesp2")
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 4,
dpi = 300)
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 3.5,
dpi = 300)
?theme
?element_rect
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
risk_fig
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 5,
height = 3.5,
dpi = 300)
5/3.5
4/2.5
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 4,
height = 2.5,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 4,
height = 2.5,
dpi = 300)
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
recreational = c(1, 1, 1, 3),
commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig,
filename = here::here("images/risk_plot.png"),
width = 4,
height = 2.5,
dpi = 300)

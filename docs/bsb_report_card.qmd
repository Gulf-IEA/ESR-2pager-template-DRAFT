---
title: "U.S. Caribbean \\linebreak Snapshot Ecosystem Status Report"
format:
  pdf:
    margin-left: "0.5in"
    margin-right: "0.5in"
    margin-top: "0.5in"
    margin-bottom: "0.5in"
    fontsize: "10pt"
    linestretch: 1
    indent: true
    include-in-header: tex_template.tex
    keep-tex: true
    papersize: letter
params:
  widths: !expr c(0.9, 0.75, 2, 3) 
  img1: !expr here::here("images/process_flow_chart.png")
  img2: !expr here::here("images/traffic.png")
  img3: !expr here::here("images/pcas.png")
  img_dir: !expr here::here("images")
latex_engine: xelatex
bibliography: bsb_references.bib
nocite: |
  @jeanmichel_copernicus_2021, @fratantoni_description_2015
csl: cambridge-university-press-numeric.csl
---

```{r setup, include=FALSE}
library(here) 
library(flextable) 
library(ggplot2) 
```

\AddToShipoutPictureBG*{%
  \AtPageLowerLeft{%
    \includegraphics[width=\paperwidth,height=\paperheight]{bg_pg1.jpg}%
  }%
}

\vspace{-2.5cm}
\section{2025}

This is a short-form update to the full 2025 U.S. Caribbean Ecosystem Status Report (ESR) [@tabandera_black_2024] highlighting the recent status of environmental, ecological, and socioeconomic factors. Indicators were compiled into two categories: tracking performance toward fishery management objectives and risks to meeting fishery management objectives.

\vspace{-0.25cm}

::: {layout="[ [0.4, 0.025, 0.575], [1], [0.575, 0.025, 0.4]] "}

:::: {}
![](`r params$img1`)
\normalsize
::::

:::: {}
\hfill
::::

:::: {}
\section{Overview of recent trends}
\vspace{-0.25cm}

\subsection{Performace indicators}

-   17 indicators were compiled to track perfomance towards management objectives.
-   Indicators were categorized as relating to food production, socioeconomic health, equality, engagement and participation, bycatch reduction, governance, and protection of ecosystems.
-   add some text about indicators

\vspace{-0.25cm}
\subsection{Risk indicators}

-   13 indicators were compiled to track risks to meeting management objectives.
-   Indicators track changes in the physical environment and human activities.
-   Major recent changes in the physical environment include increased sea surface temperature, coral bleaching stress, and ocean acidification. 
-   Other insights?
::::

:::

\vspace{0.5cm}
\section{Integrated Ecosystem Perspectives}
\vspace{0.05cm}

\subsection{Analysis}
Multivariate methods (principal components analysis and traffic light plot; see details in full report) were used to synthesize the information contained in the full suite of indicators.

\subsection{Interpretation}
The traffic plot conveys that many indicator values underwent rapid change in the period 2017-2021, and the PCA biplots confirm these patterns as there are larger two-dimensional shifts between these years. These shifts are most likely driven by several major stressor events in this time period, including the major hurricanes Maria and Irma (2017) and the COVID pandemic (2020-2021). Together, the multivariate analyses suggest that these events have had some destabilizing impacts on the U.S. Caribbean fishery ecosystem.

```{r}
#| layout-ncol: 2
#| echo: false

knitr::include_graphics(params$img2)
knitr::include_graphics(params$img3)
```

\newpage

\AddToShipoutPictureBG*{%
  \AtPageLowerLeft{%
    \includegraphics[width=\paperwidth,height=\paperheight]{bg_pg2.jpg}%
  }%
}


\newgeometry{top=0.75in, left=0.75in, right=0.75in, bottom=0.75in}

```{r tbl3, include = FALSE}
# Placeholder for your actual table data
# Replace this with your own data.frame or tibble
my_table_data <- data.frame(
  Indicator = c(
    "Mean winter (Feb-Mar) bottom temperature",
    "Shelf water volume",
    "Commercial Landings (MT)",
    "Recreational Landings (MT)",
    "Another Indicator",
    "Yet Another Indicator"
  ),
  `2023 Value` = c(8.5, 1200, 500, 300, 10, 25),
  `2024 Value` = c(7.9, 1150, 520, 280, 12, 28),
  `Time Series` = c(
    "placeholder_temp.png",
    "placeholder_volume.png",
    "placeholder_comm.png",
    "placeholder_rec.png",
    "placeholder_indicator_a.png",
    "placeholder_indicator_b.png"
  ),
  stringsAsFactors = FALSE
)

# Function to embed images in a flextable column
# This function assumes images are in params$img_dir
# You'll need to create placeholder image files (e.g., png) in your 'images' folder
# for each of these. They can be empty or simple rectangles for now.
embed_image_in_cell <- function(value, image_dir) {
  if (value %in% c("placeholder_temp.png", "placeholder_volume.png",
                   "placeholder_comm.png", "placeholder_rec.png",
                   "placeholder_indicator_a.png", "placeholder_indicator_b.png")) {
    img_path <- file.path(image_dir, value)
    if (file.exists(img_path)) {
      flextable::as_image(src = img_path, width = 1, height = 0.5) # Adjust width/height as needed
    } else {
      flextable::as_paragraph("Image Missing!") # Placeholder if image file not found
    }
  } else {
    flextable::as_paragraph(value) # If it's not an image filename, just print the text
  }
}

tbl <- flextable(my_table_data)

# Set column widths using params$widths, or adjust manually
tbl <- flextable::width(tbl, j = 1, width = params$widths[1])
tbl <- flextable::width(tbl, j = 2, width = params$widths[2])
tbl <- flextable::width(tbl, j = 3, width = params$widths[3]) # This might be the `Time Series` column, adjust if needed
tbl <- flextable::width(tbl, j = 4, width = params$widths[4]) # This might be `Time Series` image column

# Set header labels
tbl <- flextable::set_header_labels(tbl, `Time Series` = "Time Series*")

# Apply font
tbl <- flextable::font(tbl, fontname = "Times New Roman", part = "body")
tbl <- flextable::font(tbl, fontname = "Times New Roman", part = "header")

# Add superscripts for specific rows/columns
# Note: These are hardcoded for row indices 1 and 2 based on your original example.
# You'll need to adjust these if your "Indicator" values change positions.
tbl <- flextable::compose(tbl,
                          part = "body",
                          i = 1,
                          j = "Indicator", # Target the "Indicator" column
                          value = flextable::as_paragraph("Mean winter (Feb-Mar) bottom temperature (\u00B0C)"))
tbl <- flextable::compose(tbl,
                          part = "body",
                          i = 2,
                          j = "Indicator", # Target the "Indicator" column
                          value = flextable::as_paragraph("Shelf water volume (km",
                                                          flextable::as_sup("3"),
                                                          ")"))

# Embed images in the "Time Series" column
# This uses lapply to apply the embed_image_in_cell function to each cell
#tbl <- flextable::compose(tbl, j = "Time.Series", value = lapply(my_table_data$Time.Series, function(x) embed_image_in_cell(x, params$img_dir)))


# You might need to adjust row heights if your images are tall
# tbl <- flextable::height_all(tbl, height = 2, part = "body", unit = "in")
```

```{r}
#| echo: false
tbl
```

\vspace{-0.4cm}
\footnotesize \* The y-axis units are included in the "Indicator" column of the table. In all figures, the dashed line represents the time series mean, and the solid green lines indicate Â± 1 standard deviation. Commercial data were derived from the commercial dealer database hosted at the Greater Atlantic Regional Office. All dollar values have been adjusted to 2024 real dollars using the [Gross Domestic Implicit Price Deflator](https://fred.stlouisfed.org/series/GDPDEF). The code used to create this report can be viewed online: [github.com/NEFSC/READ-EDAB-bsbESP](github.com/NEFSC/READ-EDAB/bsbESP) \newline

\centering\normalsize

We welcome your observations! Please contact [northeast.ecosystem.highlights@noaa.gov](northeast.ecosystem.highlights@noaa.gov) with any on-the-water insights or changes observed in the black sea bass fishery and [nefsc.esp.leads@noaa.gov](nefsc.esp.leads@noaa.gov) with questions or comments on the information presented in this report.

\newpage
\newgeometry{top=1in, left=1in, right=1in, bottom=1in}

\AddToShipoutPictureBG*{%
  \AtPageLowerLeft{%
    \includegraphics[width=\paperwidth,height=\paperheight]{bg_pg2.jpg}%
  }%
}

# References
::: {#refs}
:::


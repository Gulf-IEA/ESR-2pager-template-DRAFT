---
title: "Black Sea Bass (\\protect\\textit{Centropristis striata}) \\linebreak Ecosystem & Socioeconomic Profile Report Card"
format: 
  pdf:
    margin-left: "0.5in"
    margin-right: "0.5in"
    margin-top: "0.5in"
    margin-bottom: "0.5in"
    fontsize: "10pt"
    linestretch: 1
    indent: true
    include-in-header: tex_template.tex    
    keep-tex: true
    papersize: letter
params:
  widths: !expr c(0.9, 0.75, 3, 3)
  img1: !expr here::here("images/bsb_map.png")
  img2: !expr here::here("images/new_condition.png")
  img3: !expr here::here("images/risk_plot.png")
  tbl_file: !expr here::here("docs/bsb_indicator_table.csv")
  img_dir: !expr here::here("images")
latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
devtools::load_all(here::here("../READ-EDAB-NEesp2"))
# here::i_am("inst/esp_template/06_docs/report card pg 1.qmd")
```

\backgroundsetup{
  scale=1,
  angle=0,
  opacity=0,
  contents={\includegraphics[width=\paperwidth,height=\paperheight]{bg_pg1.jpg}}
 }
\BgThispage

\vspace{-2.5cm}
\section{Spring 2025}

Black sea bass is an important Mid-Atlantic stock with high commercial value and recreational engagement. There are two stock subunits, divided at the Hudson Canyon. Overfishing is not occurring and the stock is not overfished. The stock assessment model uses winter bottom temperature as a recruitment covariate to incorporate the observed link between cold temperature and smaller year classes.

<!-- \vspace{-0.5cm} -->

::: {layout="[ [0.4, 0.025, 0.575], [1], [0.575, 0.025, 0.4]] "}

:::: {}
![](`r params$img1`)
::::

:::: {}
\hfill
::::

:::: {}
\section{2024 in Review}

\subsection{Fishing Community Observations}

-   Steady or increasing availability
-   Expanding distributions and changes in migration timing
-   Local regulatory complexity affects fishing opportunities

\subsection{Commercial Fishery}

-   Number of active vessels declined in 2024, but total landed pounds increased from 2023 and have been following an overall increasing trend over the last decade
-   Total revenue decreased slightly along with average prices (\$/lb)
-   Average revenue per vessel increased, following an upward trend over the past three years for vessels that remain in the fishery as the number of active vessels continues to decline

\subsection{Recreational Fishery}

-   Number of targeted trips, catch, and landings all down from 2023
-   But number of trips still above the historic average
-   Not clear if catch per angler has continued to increase in 2024

\subsection{Ecosystem}

-   Cold winter in the north but near average in the south
-   Poor or below average fish condition in recent years
::::

:::: {}
\vspace{0.5cm}
\section{Key Points from the Mid-Atlantic Risk Assessment}
<!-- \vspace{0.15cm} -->
::::

:::: {}
\raggedright

<!-- maybe this is being centered because it's the only section without a header? -->

According to the [Mid-Atlantic 2024 EAFM risk assessment update](https://static1.squarespace.com/static/511cdc7fe4b00307a2628ac6/t/6747560a3cf66936045e5547/1732728332670/05_EAFM+Risk+Assessment.pdf), Black Sea Bass scored high and/or moderately high risk in the following elements:

-   Moderate-high to high risk to the stock due to:
    -   Very high exposure to changes in climate
    -   Observed and potential changes in distribution; northward shift into the Gulf of Maine
    -   Dependence on threatened estuarine habitat
    -   Decline in the biomass of benthic invertebrate prey
    -   Decline in black sea bass body condition in the Mid Atlantic Bight
-   High risk to the recreational fishery due to:
    -   Catch exceeding harvest limits in several years
    -   High regulatory complexity; frequent changes and varying interstate regulations; regulatory changes in allocations
-   Moderate-high risk to the commercial fishery due to:
    -   Commercial revenue in wind development areas
    -   High discards & discard mortality


```{r, eval = FALSE}
devtools::load_all("../READ-EDAB-NEesp2")
risk_fig <- NEesp2::plot_risk(risk_elements = tibble::tibble(stock = c(4, 0, 2, 2),
                                                              recreational = c(1, 1, 1, 3),
                                                              commercial = c(1, 4, 2, 0)))
ggplot2::ggsave(risk_fig, 
                filename = here::here("images/risk_plot.png"),
                width = 4,
                height = 2.5,
                dpi = 300)
```
::::

:::: {}
\hfill
::::

:::: {}
![](`r params$img2`) 
![](`r params$img3`)
::::

:::

\newpage

\backgroundsetup{
  scale=1,
  angle=0,
  opacity=0,
  contents={\includegraphics[width=\paperwidth,height=\paperheight]{bg_pg2.jpg}}
 }
\BgThispage

<!-- not sure why this background isn't working -->

```{r, eval = FALSE}
# data <- readxl::read_excel(params$tbl_file) |>
data <- params$tbl_file |>
  janitor::clean_names() |>
  dplyr::mutate(figure =  paste0(params$img_dir, "/", time_series)) |>
  dplyr::select(-time_series)
```

```{r, eval = FALSE}
small_dat <- data |>
  dplyr::mutate(figure = NA) |>
  dplyr::select(-c(w, h)) |>
  dplyr::rename(`time_series*` = figure)

colnames(small_dat) <- colnames(small_dat) |>
  stringr::str_replace_all("_", " ") |>
  stringr::str_to_title()

```

```{r, eval = FALSE}
flextable::set_flextable_defaults(font.size = 10,
                                  padding.top = 6,
                                  padding.bottom = 6)
tbl <- flextable::flextable(small_dat) 
tbl <- flextable::width(tbl, j = 1:4, 
                        width = params$widths,
                        unit = "in")
tbl <- flextable::theme_box(tbl)
```

```{r, eval = FALSE}
for(i in 1:nrow(small_dat)){
  tbl <- flextable::compose(tbl,
                          i = i,
                          j = 4,
                          value = flextable::as_paragraph(
                            flextable::as_image(src = data$figure[i],
                                                width = data$w[i],
                                                height = data$h[i],
                                                unit = "in",
                                                guess_size = FALSE)))
}

tbl <- flextable::align(tbl, i = 1, j = 1:4, align = "center", part = "header")
tbl <- flextable::align(tbl, i = 1:nrow(small_dat), j = 4, align = "center")
tbl <- flextable::bg(tbl, i = 1:nrow(small_dat), j = 1:4, bg = "white")
# TODO: this height adjustment isn't working
tbl <- flextable::height_all(tbl, part = "body", height = 2)
tbl <- flextable::hrule(tbl, i = 1:nrow(small_dat), rule = "atleast", part = "body")
```

```{r, eval = FALSE}
tbl <- flextable::font(tbl, fontname = "Times New Roman", part = "body")
tbl <- flextable::font(tbl, fontname = "Times New Roman", part = "header")
```

\newgeometry{top=0.25in, left=0.25in, right=0.25in, bottom=0.25in}

```{r}
data <- NEesp2::format_tbl_data(file = params$tbl_file,
                            term_year = params$terminal_year,
                            dir = params$img_dir)
```

```{r}
tbl <- NEesp2::rpt_card_table(data,
                       widths = params$widths)
tbl <- flextable::set_header_labels(tbl, `Time Series` = "Time Series*")
```

```{r}
# this doesn't seem to do anything
tbl <- flextable::height_all(tbl, height = 2, part = "body", unit = "in")
tbl <- flextable::hrule(tbl, rule = "atleast", part = "body")

tbl

# flextable::save_as_image(tbl, here::here("images/indicator_table.png"))
```
\vspace{-0.4cm}
\footnotesize \* The y-axis units are included in the "Indicator" column of the table. \newline\newline

\centering\normalsize

Please contact [nefsc.esp.leads\@noaa.gov](nefsc.esp.leads@noaa.gov) with any questions or comments.

\vspace{0.5cm}
\raggedright

Commercial data were derived from the commercial dealer database hosted at the Greater Atlantic Regional Office. All dollar values have been adjusted to 2024 real dollars using the [Gross Domestic Implicit Price Deflator](https://fred.stlouisfed.org/series/GDPDEF).


